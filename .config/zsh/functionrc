#!/usr/bin/zsh

# yt-dlp audio with search
function yta() {
    command mpv --profile=audio --ytdl-format=bestaudio ytdl://ytsearch:"$*"
}

# Replace diff with git diff
function diff() {
    command git diff --no-index "$1" "$2"
    return 0
}

function private_mode() {
    unset HISTFILE
    printf "zsh is running in private mode, history will not be persisted.\n"
}
bindkey -s '^P' 'private_mode\n'

function mktemp() {
    local -r file_name="$(uuidgen --random)"
    if (( $# > 0 )); then
        local -r prefix="${1}-"
    else
        local -r prefix=""
    fi
    local -r runtime_dir="${XDG_RUNTIME_DIR:-/tmp}"
    local -r file="${runtime_dir}/${prefix}${file_name}"
    touch "${file}"
    if (( $(stat -c %a "${file}") != 600 )); then
        chmod 600 "${file}" >/dev/null
        printf "%s\n" "${file}"
    else
        printf "%s\n" "${file}"
    fi
}

function lfz() {
    local -r tmp="$(mktemp lfz)"
    command lf -last-dir-path="${tmp}" "$@"
    if [[ -f "${tmp}" ]]; then
        local -r dir="$(cat "${tmp}")"
        command rm "${tmp}"
        if [[ -d "${dir}" ]]; then
            if [[ "${dir}" != "$(pwd)" ]]; then
                z "${dir}"
            else
                return 0
            fi
        else
            return 0
        fi
    else
        return 0
    fi
}
bindkey -s '^N' '^ulfz\n'
