# Basic vars
set shell zsh
set shellopts '-eu'
set ifs "\n"
set scrolloff 10
set icons true #Read ~/.config/lf/icons
set cursorpreviewfmt "\033[7m" #pre-r29 behavior
set sortby time #mtime
set reverse true #Show newest files first
set incsearch true
set incfilter true
set period 1 #Set the interval in seconds for periodic checks of directory updates
set autoquit on #Automatically quit server when there are no clients left connected
set mouse true #Send mouse events as input
set preview true
set previewer ~/.config/lf/lf_kitty_preview
set cleaner ~/.config/lf/lf_kitty_clean

# cmds/functions
cmd on-cd &{{
    #Show current directory in window title
    printf "\033]0; %s - lf\007" "$(pwd | sd "$HOME" "~")" >/dev/tty
}}
cmd open ${{
    set -f
    rifle -p 0 $fx
}}
cmd open-with ${{
    set -f
    rifle -l $fx
    read -p "Open with: " method
    rifle -p $method $fx
}}
cmd mkdir ${{
    mkdir -p "$(echo $* | tr ' ' '\ ')"
}}
cmd trash ${{
    start=$(date +%s)
    trash-put $fx
    end=$(date +%s)
    duration=$(( end - start ))
    if (("${duration}" > 0)); then
        if (("${duration}" == 1)); then
            printf "It took %s second to remove %s\n\n" "${duration}" $fx
        else
            printf "It took %s seconds to remove %s\n\n" "${duration}" $fx
        fi
    fi
}}
cmd z %{{
    result="$(zoxide query --exclude $PWD $@)"
    lf -remote "send $id cd $result"
}}
cmd zi ${{
    result="$(zoxide query -i)"
    lf -remote "send $id cd $result"
}}
cmd yank-name ${{
    result="${f##*/}"
    printf "%s" "${result}" | wl-copy
}}
cmd extract ${{
    set -f
    atool -x $f
}}

# Warn about nested instances
%[ $LF_LEVEL -eq 1 ] || echo "Warning: You're in a nested lf instance!"

# Bindings
map g top
map <space> :toggle
map <esc> :unselect; clear
map DD trash
map <delete> trash
map E extract
map y
map yy copy
map x cut
map p paste
map yn yank-name
map yp $printf "%s" "$f" | wl-copy #copy full path of the current file
map <c-n> push :mkdir<space>
map <c-r> reload
map <c-f> $lf -remote "send $id select \"$(fzf)\""
map <backspace> set hidden! #<backspace> is ctrl-h, <backspace2> is backspace
map <enter> shell
map o &xdg-open "$f"
map O open-with

map r rename
map R push r<c-e>
map <f-2> push r<c-e>
