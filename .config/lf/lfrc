# Basic vars
set shell bash
set shellopts '-eu'
set ifs "\n"
set scrolloff 10
set icons true #Read ~/.config/lf/icons
set sortby time #mtime
set reverse true #Show newest files first
set incsearch true
set incfilter true
set period 1 #Set the interval in seconds for periodic checks of directory updates
set autoquit on #Automatically quit server when there are no clients left connected
set mouse true #Send mouse events as input
set preview true
set previewer ~/.config/lf/lf_kitty_preview
set cleaner ~/.config/lf/lf_kitty_clean

# cmds/functions
cmd on-cd &{{
    #Show current directory in window title
    printf "\033]0; %s - lf\007" "$(pwd | sd "$HOME" "~")" >/dev/tty
}}
cmd open ${{
    set -f
    rifle -p 0 $fx
}}
cmd open-with ${{
    set -f
    rifle -l $fx
    read -p "Open with: " method
    rifle -p $method $fx
}}
cmd mkdir ${{
    mkdir -p "$(echo $* | tr ' ' '\ ')"
}}
cmd trash !{{
    start=$(date +%s)
    trash-put $fx
    end=$(date +%s)
    duration=$(( end - start ))
    printf "It took %s seconds\n" "${duration}"
}}
cmd z %{{
    result="$(zoxide query --exclude $PWD $@)"
    lf -remote "send $id cd $result"
}}
cmd zi ${{
    result="$(zoxide query -i)"
    lf -remote "send $id cd $result"
}}
cmd yank-name ${{
    result="$(basename $f)"
    printf "%s" "${result}" | wl-copy
}}
cmd smart-rename &{{
    if [[ "$(echo "$fx" | wc -l)" -gt 1 ]]; then
        lf -remote "send $id echo You can't change more than one file name"
        lf -remote "send $id unselect"
    else
        filename=$(basename -- "$f")
        extension="${filename##*.}"
        if [[ -d "$f" ]]; then
            lf -remote "send $id rename"
        elif [[ -z "${extension}" ]]; then
            lf -remote "send $id rename"
        else
            ext_len="$(echo ${f##*.} | wc -m)"
            pos=""
            for _ in $(seq "$ext_len"); do
                pos="${pos}<left>"
            done
            lf -remote "send $id rename"
            lf -remote "send $id push "$pos""
        fi
    fi
}}

# Warn about nested instances
%[ $LF_LEVEL -eq 1 ] || echo "Warning: You're in a nested lf instance!"

# Bindings
map g top
map DD trash
map <delete> trash
map E extract
map y
map yy copy
map x cut
map p paste
map yn yank-name
map yp $printf "%s" "$f" | wl-copy #copy full path of the current file
map <esc> clear
map <c-n> push :mkdir<space>
map <c-r> reload
map <c-f> $lf -remote "send $id select \"$(fzf)\""
map <backspace> set hidden! #<backspace> is ctrl-h, <backspace2> is backspace
map <enter> shell
map o &xdg-open "$f"
map O open-with

map <f-2> rename
map R rename
map r smart-rename # before extension if necessary

map e push :!nvim<space>
